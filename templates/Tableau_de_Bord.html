<!DOCTYPE html>
<html>
<head>
  <title>PORTFOLIO TABLEAU</title>
  <link rel="icon" type="image/x-icon" href="/static/images/BAM.ico">
  <link rel="stylesheet" type="text/css" href="/static/css/Tableau_de_Bord.css">
  <script src="https://cdn.socket.io/4.0.0/socket.io.min.js"></script>
</head>

<body>
  <header>
    <img id="logo" src="/static/images/logo-groupe-bam.png" alt="Logo du groupe BAM">

    <button id="dropdown">
      {% if projet is defined %}
        {{ projet['nom'] }}
      {% else %}
        PROJETS ?
      {% endif %}
      <ul>
        {% if projets is defined %}
          {% for prj in projets %}
            <li>
              <a href="/Tableau_de_bord_JARNOT/Projets/{{ prj }} ">{{ projets[prj]['nom'] }}</a>&nbsp;&nbsp;({{ projets[prj]['nb_ops_non_finies'] }})
            </li>
          {% endfor %}
        {% endif %}
      </ul>
    </button>

    {% if projet is defined %}
    <p id="info_projet"> {{ projet['adresse'] }} {{ projet['cp'] }} {{ projet['ville'] }}</p>
    {% endif %}
    
    <button id="nom_compte"> {{ name }}
      <ul>
        {% if liste_profils is defined %}
            {% for profil in liste_profils %}
                <li>{{ profil }}</li>
            {% endfor %}
        {% endif %}
    </ul>
    </button>
    <button id="bouton_nom_compte" onclick="location.href='/logout';">x</button>

    </header>


    <div class="tableau-de_bord">
      {% if ops_projet is defined %}
        <table>
          <!-- Ligne Entêtes de colonne : Etapes -->
          <tr>
              <th>PAQUETS</th>
              {% set first_paquet = ops_projet | first %}
              {% for etape in ops_projet[first_paquet] %}
                  <th>{{ etape }}</th>
              {% endfor %}
          </tr>

          <!-- Lignes tableau -->
          {% for paquet in ops_projet %}
          <tr>
            <!-- Entête de ligne : Paquet -->
            <td>{{ paquet }}</td>

            <!-- Valeurs des cellules : opérations -->
            {% for etape in ops_projet[paquet] %}
              {% if ops_projet[paquet][etape]['profil'] in liste_profils %}
                <td id="{{ ops_projet[paquet][etape]['id'] }}" data-statut="{{ ops_projet[paquet][etape]['statut'] }}" data-profil="{{ ops_projet[paquet][etape]['profil'] }}" data-compte="{{ ops_projet[paquet][etape]['compte'] }}" data-paquet="{{ paquet }}" data-etape="{{ etape }}" modif_autoris="oui">
              {% else %}
                <td id="{{ ops_projet[paquet][etape]['id'] }}" data-statut="{{ ops_projet[paquet][etape]['statut'] }}" data-profil="{{ ops_projet[paquet][etape]['profil'] }}" data-compte="{{ ops_projet[paquet][etape]['compte'] }}" data-paquet="{{ paquet }}" data-etape="{{ etape }}" modif_autoris="non">
              {% endif %}  
              {{ ops_projet[paquet][etape]['texte'] }}
                </td>
            {% endfor %}

          </tr>
          {% endfor %}
        </table>
      {% endif %}
    </div>

  <footer>
    <div class="info_op">
      <p id="op_select">---</p>
      <p id="Etape_select">----</p>
      <p id="Paquet_select">----</p>
      <p id="Profil_select">----</p>
    </div>

    <p id="Texte_select">
    {% if projet is defined %}
      Sélectionnez une tâche du projet : {{ projet['nom'] }}
    {% else %}
      Sélectionnez un projet dans le menu déroulant.
    {% endif %}
    </p>

    <div class="Action_user">
    <p id="Compte_select">--%</p>
    <p id="Statut_select" title="Votre info-bulle ici">--%</p>
      <button id="bouton_A_FAIRE">A FAIRE</button>
      <button id="bouton_EN_COURS">EN COURS</button>
      <button id="bouton_FAIT">FAIT</button>
    </div>
  </footer>

  <script src="/static/js/clic_bouton_compte.js"></script>
  <script src="/static/js/clic_bouton_projets.js"></script>
  <script src="/static/js/initialisation_boutons_boite_de_dialogue.js"></script>
  <script src="/static/js/clic_cellule_operation.js"></script>
  <script src="/static/js/clic_bouton_AFAIRE_ENCOURS_FAIT.js"></script>
  <script src="/static/js/TempsReel_Operation_change.js"></script>


</body>
</html>
